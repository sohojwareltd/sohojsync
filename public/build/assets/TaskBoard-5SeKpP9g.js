import{r as n,a as c,j as e,S as C}from"./app-DKj5RxcS.js";import{A as T}from"./app-sidebar-layout-DAjahtRH.js";import{D as F,C as H,P as B}from"./dnd.esm-BoSCe4Ke.js";import"./x-X_D3RkiH.js";import"./index-DvAh2EAg.js";function J({project:l,auth:y}){const[S,D]=n.useState([]),[j,w]=n.useState([]),[$,E]=n.useState(!0),[I,N]=n.useState(!1),[u,b]=n.useState(null),[P,A]=n.useState([]),[r,d]=n.useState({title:"",description:"",priority:"medium",start_date:"",due_date:"",estimated_hours:"",labels:[],assigned_users:[]});n.useEffect(()=>{g()},[l.id]);const g=async()=>{try{const[s,t,i]=await Promise.all([c.get(`/api/projects/${l.id}/workflow-statuses`),c.get(`/api/projects/${l.id}/tasks`),c.get("/api/projects/users-for-assignment")]);D(s.data),w(t.data),A(i.data)}catch(s){console.error("Error fetching data:",s)}finally{E(!1)}},R=async s=>{const{destination:t,source:i,draggableId:a}=s;if(!t||t.droppableId===i.droppableId&&t.index===i.index)return;const p=parseInt(a),x=parseInt(t.droppableId),m=Array.from(j),o=m.findIndex(f=>f.id===p),h=m[o];h.workflow_status_id=x,h.order=t.index,w(m);try{await c.patch(`/api/projects/${l.id}/tasks/${p}/status`,{workflow_status_id:x,order:t.index})}catch(f){console.error("Error updating task status:",f),g()}},v=s=>{var t;s?(b(s),d({title:s.title,description:s.description||"",priority:s.priority,start_date:s.start_date||"",due_date:s.due_date||"",estimated_hours:((t=s.estimated_hours)==null?void 0:t.toString())||"",labels:s.labels||[],assigned_users:s.assigned_users.map(i=>i.id)})):(b(null),d({title:"",description:"",priority:"medium",start_date:"",due_date:"",estimated_hours:"",labels:[],assigned_users:[]})),N(!0)},k=()=>{N(!1),b(null)},L=async s=>{s.preventDefault();try{u?await c.put(`/api/projects/${l.id}/tasks/${u.id}`,r):await c.post(`/api/projects/${l.id}/tasks`,r),k(),g()}catch(t){console.error("Error saving task:",t)}},M=async s=>{if(confirm("Are you sure you want to delete this task?"))try{await c.delete(`/api/projects/${l.id}/tasks/${s}`),g()}catch(t){console.error("Error deleting task:",t)}},U=s=>{switch(s){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},_=s=>j.filter(t=>t.workflow_status_id===s).sort((t,i)=>t.order-i.order);return $?e.jsxs(T,{user:y.user,children:[e.jsx(C,{title:`${l.title} - Tasks`}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-gray-500",children:"Loading..."})})]}):e.jsxs(T,{user:y.user,children:[e.jsx(C,{title:`${l.title} - Tasks`}),e.jsx("div",{className:"py-8 px-4",children:e.jsxs("div",{className:"max-w-full mx-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:l.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Task Board"})]}),e.jsx("button",{onClick:()=>v(),className:"px-6 py-2 rounded-lg font-medium text-white",style:{backgroundColor:"rgb(61, 45, 80)"},children:"+ New Task"})]}),e.jsx(F,{onDragEnd:R,children:e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4",children:S.map(s=>e.jsx("div",{className:"flex-shrink-0 w-80",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"px-4 py-3 rounded-t-lg",style:{backgroundColor:s.color},children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.name}),e.jsx("span",{className:"bg-white bg-opacity-30 text-white px-2 py-1 rounded text-sm",children:_(s.id).length})]})}),e.jsx(H,{droppableId:s.id.toString(),children:(t,i)=>e.jsxs("div",{ref:t.innerRef,...t.droppableProps,className:`p-3 min-h-[200px] ${i.isDraggingOver?"bg-gray-50":""}`,children:[_(s.id).map((a,p)=>e.jsx(B,{draggableId:a.id.toString(),index:p,children:(x,m)=>e.jsxs("div",{ref:x.innerRef,...x.draggableProps,...x.dragHandleProps,className:`bg-white border border-gray-200 rounded-lg p-3 mb-3 cursor-pointer hover:shadow-md transition-shadow ${m.isDragging?"shadow-lg":""}`,onClick:()=>v(a),children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["#",a.id]})}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:a.title}),e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded ${U(a.priority)}`,children:a.priority})}),a.labels&&a.labels.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:a.labels.map((o,h)=>e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:o},h))}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("div",{className:"flex -space-x-2",children:[a.assigned_users.slice(0,3).map(o=>e.jsx("div",{className:"w-7 h-7 rounded-full bg-purple-600 flex items-center justify-center text-white text-xs font-medium border-2 border-white",title:o.name,children:o.name.charAt(0).toUpperCase()},o.id)),a.assigned_users.length>3&&e.jsxs("div",{className:"w-7 h-7 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 text-xs font-medium border-2 border-white",children:["+",a.assigned_users.length-3]})]}),a.due_date&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.due_date).toLocaleDateString()})]})]})},a.id)),t.placeholder]})})]})},s.id))})})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"px-6 py-4 border-b",style:{backgroundColor:"rgb(61, 45, 80)"},children:e.jsx("h2",{className:"text-2xl font-bold text-white",children:u?"Edit Task":"Create New Task"})}),e.jsxs("form",{onSubmit:L,className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:r.title,onChange:s=>d({...r,title:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:s=>d({...r,description:s.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority *"}),e.jsxs("select",{value:r.priority,onChange:s=>d({...r,priority:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Hours"}),e.jsx("input",{type:"number",step:"0.5",value:r.estimated_hours,onChange:s=>d({...r,estimated_hours:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:r.start_date,onChange:s=>d({...r,start_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:r.due_date,onChange:s=>d({...r,due_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assign To"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-3 max-h-40 overflow-y-auto",children:P.map(s=>e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:r.assigned_users.includes(s.id),onChange:t=>{t.target.checked?d({...r,assigned_users:[...r.assigned_users,s.id]}):d({...r,assigned_users:r.assigned_users.filter(i=>i!==s.id)})},className:"rounded text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name})]},s.id))})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t",children:[e.jsx("div",{children:u&&e.jsx("button",{type:"button",onClick:()=>M(u.id),className:"px-4 py-2 rounded-lg font-medium text-white",style:{backgroundColor:"rgb(155, 2, 50, 0.76)"},children:"Delete Task"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg font-medium text-white",style:{backgroundColor:"rgb(61, 45, 80)"},children:u?"Update Task":"Create Task"})]})]})]})]})})]})}export{J as default};
